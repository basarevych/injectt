!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("injectt",[],t):"object"==typeof exports?exports.injectt=t():e.injectt=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){function n(e,t,r){return(n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&i(o,r.prototype),o}).apply(null,arguments)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=new Map,this.registerInstance(this,"di")}var t,r,i;return t=e,(r=[{key:"registerInstance",value:function(e,t){if(!t)throw new Error("Injectt: No name provided for an instance");var r=this._initService(t);return r.instance=e,r.$provides}},{key:"registerClass",value:function(e){var t=e.$provides;if(!t)throw new Error("Injectt: No name provided for a class");var r=this._initService(t);return r.class=e,r.$requires=e.$requires||[],r.$lifecycle=e.$lifecycle||"perRequest",r.$provides}},{key:"has",value:function(e){if(!e)throw new Error("Injectt: No service name provided");return this.container.has(e)}},{key:"getClass",value:function(e){var t=this;if(!e)throw new Error("Injectt: No service name provided");if("string"==typeof e){var r=this.container.get(e);return r&&r.class}var n=new Map;return this.search(e).forEach(function(e){var r=t.container.get(e);n.set(e,r&&r.class)}),n}},{key:"get",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if(!e)throw new Error("Injectt: No service name provided");if("string"==typeof e)return this._resolveService(e,n,new Map);var o=new Map,a=new Map;return this.search(e).forEach(function(e){return o.set(e,t._resolveService(e,n,a))}),o}},{key:"search",value:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=this.container.keys()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var c=o.value;e.test(c)&&t.push(c)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"singletons",value:function(){var e=this;return Array.from(this.container.entries()).filter(function(e){return"singleton"===a(e,2)[1].$lifecycle}).map(function(t){var r=a(t,1)[0];return e.get(r)})}},{key:"_initService",value:function(e){if("?"===e[e.length-1])throw new Error("Injectt: Invalid service name: ".concat(e));var t;return this.container.has(e)?t=this.container.get(e):(t={},this.container.set(e,t)),delete t.instance,delete t.class,delete t.$requires,t.$provides=e,t}},{key:"_resolveService",value:function(e,t,r){var n=!0;if("?"===e[e.length-1]&&(e=e.slice(0,-1),n=!1),!this.container.has(e)){if(n)throw new Error("Injectt: No service was found: ".concat(e));return null}var i,o=this.container.get(e);if(o.instance)return o.instance;if(r.has(e))i=r.get(e);else switch(r.set(e,null),i=this._instantiateClass(o,t,r),o.class.$lifecycle||"perRequest"){case"perRequest":r.set(e,i);break;case"unique":r.delete(e);break;case"singleton":o.instance=i,r.delete(e);break;default:throw new Error("Injectt: Service '".concat(e,"' has invalid lifecycle: ").concat(o.class.$lifecycle))}if(!i)throw new Error("Injectt: Cyclic dependency while resolving '".concat(e,"'"));return i}},{key:"_instantiateClass",value:function(e,t,r){var i=e.class;if(!i)throw new Error("Injectt: No class function for ".concat(e.$provides));var a=[],c=!0,u=!1,s=void 0;try{for(var l,f=(e.$requires||[])[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var v=l.value;a.push(this._resolveService(v,[],r))}}catch(e){u=!0,s=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw s}}return n(i,o(a=a.concat(t)))}}])&&c(t.prototype,r),i&&c(t,i),e}();e.exports=u}])});